
# Vira 

VIRA( VNI inquiry and Response Assistant )


Vira is an initiative  by innovaton VNI-CE Bangalore to support our collegues on 
Aspice related queries and getting to know about VNI-CE products with Neural Network
Powered Bot. VIRA is Powered by Machine Learning and Neural networks.
VIRA intends to help in the process  knowledge sharing of Aspice and VNI-CE products.



## Scope of VIRA

1. VIRA for VNI products:
a. Currently VIRA’s scope is limited to BNC (Body and network control) products. Example Gateway, BCM, HPC, etc.

b. Communication Protocols used in BNC products

c. Diagnostic

d. AUTOSAR overview

2. VIRA for ASPICE: 

    a. ASPICE Overview

    b. Pocket guide for ASPICE Process
 
    c. SWE (Software engineering) process group

    i.Base Practices (criteria, evidences, weaknesses)

    ii.Process outcomes

    d. Output work products

## WHY RASA ?
Rasa is an open source framework to develop assistant or chatbot. The most important difference between other chantbot frameworks like Google DialogFlow, MS LUIS and Rasa it that, in Rasa all the development, training and testing in Rasa can be done locally and data remains private to the organization or the user. You can select your model to train the data, make alterations if you are not satisfied with the result.


## Prerequisites
python  3.6.x(except 3.6.6) is supported by rasa 2.8.12.


 
## Rasa Architecture


The two primary components of Rasa Architecture are Natural Language Understanding (NLU) and dialogue management.

NLU is the part that handles intent classification, entity extraction, and response retrieval. It's shown below as the NLU Pipeline because it processes user utterances using an NLU model that is generated by the trained pipeline.

The dialogue management component decides the next action in a conversation based on the context. This is displayed as the Dialogue Policies in the diagram.


## Installation 

The Python version 3.6.x is required for Rasa nlu and Rasa core .
Also the requirements.txt file can be alternatively used for installation of required dependencies.

__Install Rasa__
```bash
  --pip install rasa 
```

Create an empty folder for the chatbot and open command prompt into 
that folder. Then type the following command :

```bash
  -- rasa init  
```
After running the command , the initial model training will start and it will create folders into the directory .

```bash
 > actions
   - init.py
   - actions.py
 > data
   - nlu.yml
   - rules.yml
   - stories.yml
 > media
 > models
 > tests
   - config.yml
   - credentials.yml
   - domain.yml
   - endpoints.yml
```


## Model Pipeline and Policies Used


```bash
pipeline:

name: "WhitespaceTokenizer"
name: "RegexFeaturizer"
name: "LexicalSyntacticFeaturizer"
name: "EntitySynonymMapper"
name: "CountVectorsFeaturizer"
name: "DIETClassifier"
name: "FallbackClassifier"

policies:

name: MemoizationPolicy
name: TEDPolicy 
name: FallbackPolicy 
name: MappingPolicy
name: RulePolicy

```
## Usage/Examples

The backend strucuture was updated from JSON format to the Rasa Format  
The .yml files for the Vira for aspice , Vira for VNI-CE products and Systems 
are of similar structures. 

The File directory of the above will contain 


1. nlu.yml

```bash
- intent: cosma_kaas
  examples:  |
    - what is cosma_kaas
    - define cosma
    - explain cosma cosma_kaas
    - COSMA_kaas
```

The goal of NLU (Natural Language Understanding) 
is to extract structured information from user messages. 
This usually includes the user's 
intent and any entities their message contains.
The various examples which are given for a particular intent helps the model
to learn and train about the different types of questions that can be 
given as a input to the chatbot.

Note: For a better chatbot performance its suggestible to provide more than 4 examples 
for each of the intents


2. domain.yml


   ```bash
   utter_cosma_kaas:
   - text : "keys as a Service for meeting demands of the mobile security "  
   ```
 
The domain defines the universe in which your assistant operates. It specifies the intents, entities, slots, responses, forms, and actions your bot should know about. It also defines a configuration for conversation sessions.


__Note:__ The intents might contain dynamic links which are required for redirecting to specific links , thus maintain a actions at end of domain.yml.

```bash
   actions:
   - action_cosma_kaas
``` 


3. stories.yml 

```bash
   - story: cosma_kaas
     steps:
     - intent : cosma_kaas
     - action : action_cosma_kaas
```
    Stories are a type of training data used to train your assistant's dialogue management model. Stories can be used to train models that are able to generalize to unseen conversation paths


4. actions.py

 
     After each user message, the model will predict an action that the assistant should perform next. This page gives you an overview of the different types of actions you can use.

- A response is a message the assistant will send back to the user. This is the action you will use most often, when you want the assistant to send text, images, buttons or similar to the user.
- A custom action is an action that can run any code you want. This can be used to make an API call, or to query a database for example.

- Forms are a special type of custom action, designed to handle business logic. If you have any conversation designs where you expect the assistant to ask for a specific set of information, you should use forms.

- Default actions are actions that are built into the dialogue manager by default. Most of these are automatically predicted based on certain conversation situations. You may want to customize these to personalize your assistant.


Create a custom action and also need to add the custom python script.Then  update the stories as per the actions created in the actions.py file. Domain file will also be updated to add the dynamic links to make the change in the bot’s response in real time.


```bash
  class action_cosma_kaas(Action):
    def name(self) -> Text:
        return "action_cosma_kaas"

    def run(self, dispatcher: CollectingDispatcher,
            tracker: Tracker,
            domain: Dict[Text, Any]) -> List[Dict[Text, Any]]:
        Link_11= "https://www.continental-automotive.com/en-gl/Passenger-Cars/Company/Automotive-Technologies/Story-AT/Smart-Mobility"

        print("Link_11: ", tracker.get_slot('Link_11'))


        text = tracker.latest_message['text']
        print(text)
        dispatcher.utter_template("utter_cosma_kaas", tracker, Link_11=Link_11)
        return []


```

__Note:__ Update the endpoints.yml file to make this action file sun and also to start the action server. In the endpointys.yml file uncomment the following lines and save the file (to run on the local server):


 ```bash
   action_endpoint:
   url: "http://localhost:5055/webhook"  
   ```


5. Use the commands for run the bot in local machine 

  ```bash
    > rasa train 
  ```
```bash
  > rasa shell
```



## Deployment


The initial version of VIRA is developed using HTML,CSS,Javascript code.In 
the pilot version Rasa framework is implemented in backend which helped to overcome the 
shortcomings of the initial phase.

The Rasa framework has been used for the 

    1. VIRA for ASPICE
    2. VIRA for VNI-CE Products 
    3. Systems 


The backend strucuture was updated from JSON format to the Rasa Format  
The .yml files for the Vira for aspice , Vira for VNI-CE products and Systems 
are of similar structures. 
Deployed a playground server for the bot to see the feasibility while the existing one stays intact. The approach would be someway complex, running the Django server from the traditional method and starting the rasa instance from the batch scripts upon startup and the Django calling rasa hooks via ajax for request/response.

The VIRA can accessed  at http://ozd2111u:8080/

__Note:__ Please use Cisco VPN for accessing VIRA. And use http instead of https for accessing VIRA.